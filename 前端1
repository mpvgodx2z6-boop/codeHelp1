# 前端落地方案：基于 next-admin 改造（v1）

> 目标：在开源 `next-admin`（Next.js + Ant Design）基础上裁剪与改造，完成「公共提示词整理工具」前端 v1。
>
> 包管理：pnpm  
> UI：Ant Design（简约大气），启用 ConfigProvider  
> 运行形态：Web  
> v1：单人使用，但必须有登录页

---

## 0. 与你的规范（1~13）如何落地到产品里

### 0.1 代码注释规范（规则 1~3）
- 工具本身的代码开发时：新建一个“注释规范”文档条目（Standards -> code），并要求后续所有代码按块注释：
  - `/***********xx功能开始************/`
  - （代码）
  - `/***********xx功能结束************/`
- 在工具里提供“规范中心 -> 代码与注释规范”模板，方便复制粘贴到项目规范中。

### 0.2 文档与 500 行限制（规则 4）
- 工具提供导出 Markdown 时自动拆分（>500 行拆分为 part-1/part-2…）。
- 工具自身代码文件的 500 行限制：以“开发规范”形式记录在 Standards 中，并在 PR/提交前人工检查（v1 不做自动扫描）。

### 0.3 变更记录强制（规则 5）
- v1 必须实现 Change Log：每次建表/改表/新增功能/修复必须录入：
  - 修改了哪些（summaryItems）
  - 解决了哪些问题（problemsSolvedItems）
  - 影响范围（模块/文件/字段/接口）

### 0.4 人工测试反馈闭环（规则 6~7）
- v1 实现 Test Log 并强制关联 Change。
- Test Log 必须包含反馈原文 + 结论 + 后续动作（是否新增提示词/补文档/修复）。

### 0.5 强化记忆（规则 8）
- v1 用“提示词版本历史 + 错误模式纠偏提示词”实现可追溯的“强化”：
  - 每次修改提示词必须填：修改原因、期望避免的错误
  - 生成器可选追加“近期错误模式”条目

### 0.6 生成前查 Git 相关信息（规则 9）
- v1 先用“人工关联”：
  - 模块级：relatedFiles/Fields/Apis
  - 变更级：affectedFiles/Fields/Apis
- 生成器默认合并两层并去重；后续 v2 再做 Git 自动扫描。

### 0.7 DB 规范与时间组件（规则 10）
- v1 在 Change Log 的 create_table/alter_table 类型中提供 DB 检查清单：
  - create_time / update_time / create_by / update_by
  - isJunctionTable（特殊中间表可放宽）
  - index/search 说明字段
- UI 中涉及时间字段统一用 DatePicker 并统一格式展示。

### 0.8 鉴权/token 安全（规则 11）
- v1 虽然单人使用，但必须有登录页，并明确 token 存储策略：
  - 优先：HttpOnly Cookie（如后端支持）
  - 若纯前端本地：临时用 localStorage（必须在“安全规范”里写明风险与替代方案）
- v1 先实现前端鉴权壳（route guard），后端可后续���入。

### 0.9 pnpm（规则 12）
- 项目统一 pnpm；文档写明安装与脚本。

### 0.10 每次代码提交 Git（规则 13）
- 工具内提供“导出中心”：导出 JSON 备份到仓库（可版本追踪）。
- 代码提交仍由人工执行；在 Change Log 与 Test Log 中记录“已测试/待测试/可提交”。

---

## 1. 基于 next-admin 的裁剪策略（建议）

### 1.1 保留
- Ant Design Layout（侧边栏 + 顶栏 + Content）
- 路由结构与页面容器
- 登录页框架（如已有）
- 通用表格/表单模式
- 权限/路由守卫框架（用于 v1 登录后访问控制）

### 1.2 删除/禁用（保持轻量）
- 非必须的报表大屏、复杂可视化示例页面
- 与业务无关的 demo 模块
- 多余的国际化（若默认中文即可，可先保留框架但只保留 zh-CN 资源）

### 1.3 新增（本项目核心模块）
- 规范中心 Standards
- 模块管理 Modules
- 变更记录 Changes
- 人工测试记录 Tests
- 提示词库 Prompts
- 模板管理 Templates
- 生成器 Builder（默认 8 块输出）
- 导出中心 Export（JSON 备份/导入 + 生成结果导出）

---

## 2. v1 页面路由与菜单（定稿）

- `/login` 登录页（必须）
- `/` 仪表盘（可简单：最近变更、最近测试、最近生成、最近备份时间）
- `/standards` 规范中心
- `/modules` 模块管理
- `/changes` 变更记录
- `/tests` 人工测试记录
- `/prompts` 提示词库
- `/templates` 模板管理
- `/builder` 生成器
- `/export` 导出中心

---

## 3. 生成器默认 8 块（必须实现且一致）

1. 背景/目标  
2. 相关模块  
3. 相关文件/字段/接口（模块级 + 变更级合并，可切换仅模块/仅变更/合并）  
4. 变更摘要  
5. DB 检查清单  
6. 测试反馈  
7. 适用规范（默认摘要 + 可展开全文；导出可选摘要/全文）  
8. 提示词清单/输出要求  

每块要求：
- Card 展示
- “复制”按钮
- “导出单块 md”按钮
- 合并稿 Tab/抽屉：一键复制、一键导出 md（自动 500 行拆分）

---

## 4. 数据存储（v1：IndexedDB + JSON 备份）

### 4.1 IndexedDB（Dexie）表
- modules
- standards（summary + contentChunks）
- changes（含 dbChange、affected*）
- tests
- prompts（含 revisions）
- templates（blocks 可配置）
- builds（生成历史）
- app_meta（schemaVersion、lastBackupAt）

### 4.2 JSON 备份（可进 Git）
- 导出文件名：`prompt-tool-backup-YYYYMMDD-HHmm.json`
- v1 导入策略：覆盖导入（后续再做合并导入）

---

## 5. 登录与鉴权（v1 必须有）
### 5.1 v1 目标
- 能登录进入系统，不登录则只能访问 `/login`
- token/session 方案在 v1 先做“可运行”，并在安全规范中记录风险

### 5.2 推荐实现（按优先级）
1) 若 next-admin 已内置登录鉴权：复用其方案  
2) 若需要快速落地且无后端：本地密码（仅开发/个人使用）+ localStorage session（必须在安全规范标注“非生产安全方案”）  
3) 后续 v2 再接入真实后端（cookie/httpOnly、refresh token 等）

---

## 6. Markdown 编辑器（v1 必���）
- 用于 Standards、Prompts、Templates（块说明/模板说明）、Builder 输出预览
- 需求：
  - 编辑/预览
  - 支持复制
  - 内容保存到 IndexedDB

---

## 7. 交付清单（你让大模型写代码时要拆的任务）
1) 清理 next-admin demo 页面与菜单（保留 layout、登录、权限框架）
2) 引入 Dexie 并实现表结构 + schemaVersion
3) CRUD：modules / changes / tests / prompts / templates / standards
4) Builder：选择器 + 8 块输出 + 合并稿
5) Export：JSON 备份导出/导入 + Markdown 导出（500 行拆分）
6) UI：统一 ConfigProvider + 简约风格（间距、字号、Card/Table 规范）
7) 文档：把 UI 规范、数据结构、变更记录规范写入 docs（每份 md < 500 行）

---
